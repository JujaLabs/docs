# Github and Team workflow for JuJa Microservices
## Git Flow
В наших проекта мы используем переработанный аналог **git flow** (
оригинал: [A successful Git branching model](http://nvie.com/posts/a-successful-git-branching-model))

#### В чем наши отличия:
1. В основном репозитории могут быть только ветки **develop** и **master** и временные ветки **hotfix**.
2. Мы используем **fork** и для создания новых feature веток. После окончания работы происходит pull request в ветку 
develop в основном репозитории
3. После того как мы готовы выпустить очередной релиз, в основном репозитории делается merge develop в master и 
присваивается **tag** с номером релиза. Пример 0,1 или  1,0 и т.д.
4. Если необходимо сделать срочный **hotfix** в **release**, тогда в основном репо делается ветка с названием 
**hotfix-"namefixes"**. После того, как задача сделана, изменения добавляться в ветки **master** и **develop** основного 
репо. При этом в tag добавляется минорный номер к релизу. Пример tag текущего релиза 0.1 а после внесения фиксов стал 
0.2. 

### Процесс работы над задачами, проведение code review, организация работы в команде, работа с ветками 
 
#### 1. Процесс создания задачи
1. Задачи создаются в колонке **Backlog** в нужном проекте.
2. Описание задачи должно быть максимально полным и понятным для понимания.
3. Если задача является продолжением другой, то в описании к ней должна быть ссылка на предыдущую.
4. Все задачи при создании в колонке **Backlog** не имеют исполнителей. Исполнитель назначается при переносе задачи в 
колонку **In progress**.	

#### 2. Процесс начала работы над задачей
1. Найти свободную задачу в колонке **Backlog**. Поиск новых задач необходимо начинать сверху списка.
2. После того, как задача выбрана, за ней необходимо закрепить исполнителя, т.е. себя.
3. Перенести задачу в колонку **In progress**.
4. Перед созданием ветки для задачи необходимо залить последнюю версию **upstream репозитория**. 
[Ссылка](https://help.github.com/articles/syncing-a-fork), как сделать.
5. В своем репозитории необходимо создать ветку для задачи. 
Формат названия ветки **"task number"-"feature name"**. Пример: 123-important-feature. 
6. Приступить к  работе над задачей.

#### 3. В процесс работы над задачей
1. Во время работы необходимо придерживаться Java Code Convention.
2. Сообщения в коммитах должны быть в формате **#123: commit message**. 
3. На задачу должны быть обязательно написаны тесты:
    * 100% покрытие **unit** тестами.
    * Все критические моменты покрываем **integration** тестами.   
    * Все эндпоинты покрываем **acceptance** тестами и по возможности **integration** тестами.
4. При выполнении задачи необходимо следить за логированием. В проектах используеються такие правила логирования
    * **info** один на методы в контроллерах и методах бизнес логики,
      Пример в контроллере
      ```
      logger.info("Added welcome achievement, id = {}", ids.toString());
      ```
    * **warn** на каждый Exception, ошибку бизнес логики, каждый не нормальный поток поведения. 
       Например не смогли найти пользователя или еще чего
    * **error** когда что-то реально сломалось и дальше работать нельзя никак
    * **debug** на каждый рабочий метод в контроллере, сервисе или dao чтобы можно было включить полные логи проверить что  происходит. Если есть вызовы других сервисов, методов, оборачиванием в  debug логирование до и после метода
    ```
   logger.debug("Started conversion SlackName: [{}] to UUID", slackName);
   String uuid = userService.findUuidUserBySlack(slackName.toLowerCase());
   logger.debug("Finished conversion SlackName: [{}] to UUID : [{}]", slackName, uuid);
    ```

5. После того, как работа закончена, необходимо залить ветку с задачей в свой fork-репозиторий на github и сделать pull 
request в upstream репозиторий в ветку, в которой ведется разработка проекта (master или другая в зависимости от проекта 
и ситуации).
    * Имя **pull request** должно быть  в формате **#123 important feature**.
    * Pull request должен быть связан с задачей, это делается добавлением строки **connect to #123** в поле с 
    описанием.
    * После создания pull request, **Travis CI** автоматически запустит сборку проекта. Необходимо проверить, чтобы она 
    прошла удачно. Если сборка не пройдет, необходимо изучить log travis и устранить ошибки. Увидеть, как прошла сборка, 
    можно в github, если открыть pull request. Лог сборки можно посмотреть, кликнув на **Details**.
6. После этого необходимо перенести задачу в колонку **Review**.
7. Для того, чтобы задача была добавлена в ветку разработки команды, необходимо наличие 2 **code review** (это значение 
может меняться в зависимости от проекта и договоренностей в команде).
8. Общее время работы над задачей не должно превышать 2 недели. Если разработчик не может решить задачу без объективных 
причин, необходимо отказаться от ее выполнения и вернуть в колонку **BackLog**.

#### 4. Если не удается решить задачу
1. Попросить коллег про помощь в общем чате команды.
2. Если для решения данной задачи нужно решение другой задачи, необходимо в исходном коде оставить комментарий 
**//TODO** или **@todo** c описанием того, что надо сделать и ссылкой на задачу, которая нужна. Если  такой задачи нет, 
ее необходимо добавить в **BackLog** проекта. 

#### 5. Если задача заблокирована другой задачей 
#### (в процессе работы над задачей необходим функционал, которого еще нет и нет возможности это легко обойти)
1. Добавить  комментарий к своей задаче **blocked with #123**. Если эту задачу уже кто-то делает, 
необходимо связаться с ним и договориться о дальнейших шагах.
2. Если решение блокирующей задачи затягивается, текущую необходимо вернуть в колонку **BackLog** и вернуться к 
**пункту 2**.

#### 6. Проведение review
1. Делать **review** может любой желающий в команде.
2. К review допускаются только задачи, для которых **Travis** успешно выполнил прогон тестов.
3. Ревьювер должен придерживаться следующих **правил**:
    * В начале ревью необходимо начать этот процесс на github. Более подробно в 
    [документации](https://help.github.com/articles/about-pull-request-reviews).
    * Если замечаний нет, то завершить процесс review с отметкой **Approved**.
    * Если есть комментарии, оставить их, используя **Comment**.
    * Если есть существенные замечания, которые должны быть устранены до merge, необходимо оставить 
    **Request changes**.
    * Статусы **Comment** и **Request changes** - не разрешают сделать merge pull request, пока не будет реакции 
    владельца pull request и не будет выставлен статус **Approved**.
4. После того, как условие по количеству ревью выполнено, владелец pull request должен уведомить team lead или 
человека у которого есть права на merge, провести финальное ревью и сделать merge в ветку разработки.
5. После успешного принятия изменений задача передвигается в колонку **Done** и ответственный за нее разработчик 
переходит к **пункту 2**.
6. Если в процессе ревью необходимы существенные доработки, задача возвращается в колонку **In progress** и разработчик 
переходит к **пункту 3**. Закрывать при этом pull request не нужно. Все изменения, которые будут попадать в ветку, с 
которой он был сделан, автоматически будут подтягиваться в pull request. 

#### 7. Разное
1. Если условие задачи непонятно, необходимо запросить дополнительные сведения.
2. Если задача слишком объемная и ее сложно сделать за 2 недели, необходимо обсудить с team lead пути, как разбить ее на 
несколько, и сделать эту операцию, используя **пункт 1**. После этого необходимо выбрать новую задачу, используя 
**пункт 2**.
3. Добавлять изменения без кодревью  в основную ветку проекта **запрещается**.
 
#### Линки на tutorial, для самых частых операции при работе с github 

##### Following the GitHub flow

1. [Create a branch](https://help.github.com/articles/creating-and-deleting-branches-within-your-repository )
from the repository.
2. [Create](https://help.github.com/articles/creating-new-files), 
[edit](https://help.github.com/articles/editing-files), 
[rename](https://help.github.com/articles/renaming-a-file), 
[move](https://help.github.com/articles/moving-a-file-to-a-new-location), 
or [delete](https://help.github.com/articles/deleting-files) files.
3. [Send a pull request](https://help.github.com/articles/about-pull-requests) from your branch with your proposed 
changes to kick off a discussion.
4. Make changes on your branch as needed. Your pull request will update automatically.
5. [Merge the pull request](https://help.github.com/articles/merging-a-pull-request) once the branch is ready to be 
merged.
6. [Tidy up](https://help.github.com/articles/deleting-unused-branches) your branches using the delete button in 
the pull request or on the branches page.
